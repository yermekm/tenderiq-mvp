import streamlit as st
import pandas as pd

st.set_page_config(page_title="TenderIQ MVP", layout="wide")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ğ¸ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.title("TenderIQ â€” Ğ´ĞµĞ¼Ğ¾-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ¾Ğ²")
st.markdown(
    """
    **ĞšĞ°Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ:**
    1. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ CSV-Ñ„Ğ°Ğ¹Ğ» Ñ Ğ²Ñ‹Ğ³Ñ€ÑƒĞ·ĞºĞ¾Ğ¹ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ¾Ğ² *(Goszakup export)*  
       â€” Ğ¸Ğ»Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ° (Ğ¿Ğ¾ĞºĞ° Ğ·Ğ°Ğ³Ğ»ÑƒÑˆĞºĞ°).  
    2. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ **ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ** â€” ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ñ€Ğ¸ÑĞ²Ğ¾Ğ¸Ñ‚ ÑƒĞ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Risk Score.  
    3. Ğ¡ĞºĞ°Ñ‡Ğ°Ğ¹Ñ‚Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ĞºĞ°Ğº CSV Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½Ğµ.
    """
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
uploaded = st.file_uploader("Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ CSV", type=["csv"])
url = st.text_input("URL Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ° (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ£Ğ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ÑĞºĞ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ´Ğ»Ñ MVP
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def dummy_score(row: pd.Series) -> int:
    """ĞŸÑ€Ğ¾ÑÑ‚ĞµĞ¹ÑˆĞ¸Ğ¹ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚ Ñ€Ğ¸ÑĞºĞ° Ğ´Ğ»Ñ Ğ´ĞµĞ¼Ğ¾Ğ½ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸."""
    risk = 0
    # Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°
    if "ĞºĞ¾Ğ½ĞºÑƒÑ€Ñ" in str(row.get("proc_method", "")).lower():
        risk -= 10        # ĞºĞ¾Ğ½ĞºÑƒÑ€Ñ = Ğ¼ĞµĞ½ÑŒÑˆĞµ Ñ€Ğ¸ÑĞºĞ°
    if row.get("single_source", False):
        risk += 30        # ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº
    try:
        price = float(row.get("price", 0))
        if price > 1_000_000_000:
            risk += 20    # Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ ÑÑƒĞ¼Ğ¼Ñ‹ â€” Ğ²Ñ‹ÑˆĞµ Ñ€Ğ¸ÑĞº
    except ValueError:
        pass
    return max(0, min(100, 50 + risk))

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if uploaded:
    df = pd.read_csv(uploaded)
    st.write("### ĞŸÑ€ĞµĞ´Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…", df.head())

    df["RiskScore"] = df.apply(dummy_score, axis=1)
    st.write("### Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ñ ÑƒĞ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½Ğ½Ñ‹Ğ¼ Risk Score", df)

    csv_out = df.to_csv(index=False).encode("utf-8")
    st.download_button(
        "Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ CSV",
        data=csv_out,
        file_name="tenderiq_scored.csv",
        mime="text/csv",
    )

elif url:
    st.info("ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ URL Ğ±ÑƒĞ´ĞµÑ‚ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ½Ğ° ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼ ÑÑ‚Ğ°Ğ¿Ğµ ğŸ˜‰")
    st.write(f"Ğ’Ğ²ĞµĞ´Ñ‘Ğ½Ğ½Ñ‹Ğ¹ URL: **{url}**")

else:
    st.warning("Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ CSV Ğ¸Ğ»Ğ¸ Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ URL Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°.")
